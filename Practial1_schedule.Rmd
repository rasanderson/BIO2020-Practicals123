---
title: 'Practical 1: Data import Summary and display'
author: "BIO2020"
output:
  word_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, message=FALSE,warning= FALSE}
library(dplyr)
```

## Aims and objectives of Practical 1
The overall aim of this practical is to help you become more familiar with RStudio, what its main panels are for, and some basic summary statistics and visualisations. The specific objectives are to:

1. explain the concept of RStudio projects to allow you to store data, files containing R commands (known as scripts), and the 4 main panels in RStudio
2. demonstrate the value of .csv files (comma separated files) as these can be read / written by both R and Microsoft Excel
3. learn how to import data from .csv files into R using some simple R commands, that can be saved in an R script for later re-use
4. explain how to calculate simple summary statistics of the data you have imported into R
5. create of some simple summary plots to aid interpretation
6. show you how these graphs and tables of calculated statistics can be exported to Microsoft Word and Microsoft Excel

We will primarily focus on two datasets: 
* `Chick_Diet.csv` This contains the final weights of chicks after 21 days on four different diets.
* `Chick_growth.csv` This shows the average growth rate on each day of all the chicks from day 0 (hatching) to day 21.

## Setting up for practical classes

We are going to start by creating a Project called BIO2020 to keep all of our work relating to the BIO2020 module together in one place.

Start by opening up R Studio on your computer. 
To create a new project click on the main menu on  `File` > `New Project`  

You should now see this popup window: 

```{r, echo = FALSE}
knitr::include_graphics("http://www.rstudio.com/images/docs/projects_new.png")
```

Select `New directory`  then  `New Project`

Give your project a name (eg. the name of the module) and select where on your computer you want that to live.
Click `Create project` and you should now see the name of your project displayed in the top right hand side of your R Studio window. 

**NOTE** If you are an organised person and you had already created a folder for all of the work associated with the BIO2020 module you can select `Existing Directory` navigate to your already existing folder and then select create project and the `.RProj` file will live in that folder alongside all your other files

Within your BIO2020 Project folder we suggest that you create a `r emo::ji("file_folder")` Data sub-folder.
The data files for all of the practical classes are available on Canvas, you should download the files and store them in the Data folder that you just created. 

The next step is to create a new `script` to store all of the code for today's practical. 
In the top left click `file` > `new file` > `R script`
Click on the save icon `r emo::ji("floppy_disk")` to save this script and give it a meaningful name eg. `Practical_1.R`

Depending on your system, your RStudio window will roughly look like this:

![RStudio Screen](images/RStudio_screen_practical1.png)

**What are the 4 different components of the screen?**

* Top left. This is the new empty 'script' file `Practical_1.R` that you have just created. You can use this to store your R commands for later re-use. You can put comments after a `#` sign to help remind you what the commands do.
* Top right. This has several tabs, but the one shown above is the 'Environment' which will show the names of tables of data, the names of results of analyses etc. As you have not done anything yet, it is empty.
* Bottom right. Again, several tabs. You will often use the 'Plots' and 'Help' tabs. Shown above is the 'Files' tab which shows the `BIO2020.Rproj` file which contains all your settings (colours, font size, zoom level etc.) and your `Practical_1.R` which is also displayed in the top left panel.
* Bottom left. This is headed 'Console'. You can enter R commands directly into the Console. You can also copy R commands from your `Practical_1.R` script into the Console for re-use. It is this ability to store a set of R commands in a simple script for re-use that is so valuable. 

### Running R commands

You might notice that in the online interactive website tutorials that you completed on your own we ran R code by clicking on a big green run code button, when we are working in RStudio it's a little bit different. 

You write your code in your script (because you have listened to our advice and you know that writing code in the script means you can save it and come back to it later) and there are a couple of ways to *run* the code and you can choose whichever feels best for you. 

1. Highlight the code that you want to run and then press the `run` button that is available at the top of the script

2. Place your cursor anywhere on the line of code that you want to run and press <kbd>Ctrl</kbd> + <kbd>Return</kbd> (<kbd>Cmd</kbd> + <kbd>Return</kbd> on mac) together

Either of these actions sends your code to the console where it is executed so that R carries out the instructions that are your code.

## Importing data from an external file into RStudio

Firstly check that you are working in the project (BIO2020) that you just created, the project icon in the top right hand side of your R studio window should be displaying the name of your project.

For this practical we will be using the following data files:

 + Chick_Diet.csv
 + Chick_growth.csv

To use these files we need to load them in to R and store each one in R's memory as an object. 
Check that you have these files stored in `r emo::ji("file_folder")` **Data**, the sub-folder of your project. The .csv format is very useful, as it can be imported and exported by both R and Microsoft Excel. If you are curious, try opening one of the files in Excel.
If they are there we can start by reading them in to R to get them into the `Environment`.

### Cookery with RStudio?
Some people find a cooking analogy useful to help understand the different components of the RStudio screen!

```{r, fig.align='center', echo = FALSE}
knitr::include_graphics("images/Rkitchen.png")
```

### Where to type your R commands
We are now going to show you how to import the data from your .csv files into RStudio and temporarily store them as R "objects" called `diet_dat` and `growth_dat` using the `read.csv()` function. Please write your R comands in the script `Practical_1.R` (top left panel of RStudio). You can save and re-run the script later. You do not actually need to save the temporary R objects `diet_dat` and `growth_dat` as you can re-create them within seconds from your R script. **It is always important to save your script**.

Remember that the argument to the `read.csv()` function is the path to the file e.g. as follows, assuming you made a `Data` folder. **Important** R is "case-sensitive", so if you put `chick_diet.csv`, `Chick_diet.csv` or `chick_Diet.CSV` etc. you will get an error that R cannot find the file. 

Type the next three lines into the top of your `Practical_1.R` script in the top-left panel of RStudio:

```{r}
# Introduction to R. Basic data handling

diet_dat <- read.csv("Data/Chick_Diet.csv") # Read in diet data
```

A few points about the above 4 lines of code

* The first line contains the `#` sign. This tells R to ignore the rest of the line. This is a "comment" and is probably the most important single command you will ever use. I put comments throughout my R scripts, so that when I re-use them months later I understand what they are doing. I generally use the first line to remind myself what the script is going to do.
* The second line is blank. Students tend to be poor at including blank lines. However, it is a good idea to group a set of related R commands together, and then separate them with one or two blank lines, in the same way that you use paragraphs when writing an essay to structure the text.
* The third line contains an R function called `read.csv()` which imports the `Chick_Diet.csv` file into the R environment. It takes a single 'argument' in double-quotation marks, namely where the csv file is stored and its name.
* The third line contains the `<-` symbol that points into `diet_dat`. This means "assign the output the `read.csv()` function into the R table of data called `diet_dat`". If you look at the top-right window of you should notice that the "Environment" tab is no longer empty, but now contains the `diet_dat` table. Tables of data in R are usually known as "data frames" and you will see this term pop up several times in this course.
* Finally, the third line also contains a comment, but at the end of the line, after the R commands.

<!-- Note for demonstrator, if they have trouble reading in the data file check where the script file is saved, if it's in a sub-folder of the project the code specifying the file path will need to escape that sub-folder first using ../ so they need  read.csv("../Data/Chick_Diet.csv")-->

**Check the data that you have loaded**
Some suggested functions are `head()` `str()` `summary()` `nrow()` `ncol()` `names()` 
Use these functions to answer the following questions about the data

 1. What variables are contained within each dataset?
 2. How many variables(columns) and how many observations (rows) are in each dataset? 
 3. How heavy is the heaviest chicken? And is this the same in both of the datasets?

**Reminder** Make sure to comment your code, using the # write some comments (notes) to annotate the code that you have just written so that you know what all of the code in your script is, eg.

```{r, eval = FALSE, echo= TRUE}
# reading in the Chick_Diet data file 
diet_dat <- read.csv("Data/Chick_Diet.csv")
# Display the first few lines of the data
head(diet_dat)
# Inspect the structure of the data
str(diet_dat)
# Try the nrow(), ncol() and summary() functions
```

 
Now that you have explored the dataset you can see that the `diet_dat` data contains the variables weight, Time, Chick and Diet.
The `growth_dat` contains the variables Weight (note that this one is with a capital W), Time and Diet.

The data refer to weights of growing chickens being fed one of four different Diets, `diet_dat` contains the weights of 50 individual chicks after a 21 day time period whereas `growth_dat` details the mean weight (across all individuals being fed the same diet) at each time point.


### Loading Packages

Throughout the rest of this practical we are going to be using functions from two packages: 

`r emo::ji("package")` mosaic

`r emo::ji("package")` ggformula

**You may have already installed these packages, as well as the `bio2020` package using the instructions at [Getting Started](https://ncl.instructure.com/courses/23926/pages/the-bio2020-r-package). If so, then you can 'load' them all via `library(bio2020)` ** 

**Installing packages** is only required the first time that we use the package, because of this we **don't** want this code to be in our script because that might cause us to unnecessarily install the package each time we run the code in this script.
I know that we said to *always* write your code in a script but the `install.packages()` function is one of the very few exceptions.
To install the packages you can type the following code directly into the **console**. You may already have installed these via the instructions at [Getting Started](https://ncl.instructure.com/courses/23926/pages/the-bio2020-r-package) in which case there is no need to repeat them.

```{r, eval = FALSE}
install.packages("mosaic")
install.packages("ggformula") # ggformula should be automatically installed by mosaic
```

Or you can navigate to the packages tab, click the install button and type the name of the package that you want to install. 

Once the package is installed we need to load it, this *does* need to be done every time that we use functions from the package so we will put this code in our script.
It is best practice to load packages at the start of your script, so go to the top of your script and load the packages using the `library()` function.

Remember the argument to the `library()` function is the name of the package that you want to load

The top of your script should read something like this; `#` symbol indicates a comment:

```{r, message = FALSE, warning= FALSE}
# If you have installed the bio2020 package uncomment the following line; bio2020 loads all needed packages
# library(bio2020)
# If you have installed bio2020, comment the following 2 lines with # symbols as no need to load packages
library(mosaic)
library(ggformula)

# reading in the Chick_Diet data file 
diet_dat <- read.csv("Data/Chick_Diet.csv")
```

The line shown as `diet_dat <- read.csv("Data/Chick_Diet.csv")` imports your .csv file into RStudio, into an R "object" called `diet_dat` known as a "data.frame". A data.frame is basically a table of data, and is how most raw data is held within an R session. **Note** R is case sensitive, so `diet_dat` and `Diet_dat` are not the same.

## Summary statistics

We will start with the `diet_dat` data.
We can calculate some summary statistics to see if there are differences between chicks being fed different diets.

Calculate the mean weights for chicks being fed different diets.
Remember we are using the formula 

$$\text{statistic(variable ~ group, data= dataset)}$$

Where:

+ **statistic** = the statistic that we want to calculate (mean, median, sd, etc.)
+ **variable** = the name of the column containing the variable that we are interested in 
+ **group** = the name of the column containing information by which we want to group the data

For each group we can calculate statistics such as the mean and median

```{r}
mean(weight~Diet, data = diet_dat)
median(weight~Diet, data = diet_dat)
```

```{r, echo= FALSE}
chick_mean <- mean(weight~Diet, data = diet_dat)
chick_med <- median(weight~Diet, data = diet_dat)
```

**Store these values in objects called `chick_mean` and `chick_med`**

But remember that these measures can be sensitive to outliers and to get a good understanding of our data we need to calculate some statistics that give us an idea of how our data is spread about the mean.
If this is unfamiliar to you go back over the `Understanding measures of central tendency and variation` tutorial.

Thankfully because we are doing our analysis in R we don't have to calculate measures such as variance, standard deviation and standard error by hand, we can use functions to help us.

**Calculate the variance and standard deviation for each group using the functions `var()` and `sd()`**

```{r}
# calculate variance for each group
var(weight~Diet, data = diet_dat)
# calculating standard deviation for each group
sd(weight~Diet, data = diet_dat)
```

Now that we have this useful information lets make sure that we keep it.

**Create two objects `chick_var` and `chick_sd` and assign the output of the `var()` and `sd()` functions to those objects.**

```{r}
# calcualating variance for each group
chick_var <- var(weight~Diet, data = diet_dat)
#calculating standard deviation for each group
chick_sd <- sd(weight~Diet, data = diet_dat)
```

Remember that we also discussed Standard Error as a useful measure that can be calculated as:

$$se = \frac{\sigma}{\sqrt{n}}$$

We have already calculated the variance but for the calculation of se we need to know n, the number of observations in our group.
Again there is no need to count the number of observations in each group by hand, lets use the `favstats()` function which also computes some other useful measures that we might be interested in. The name `favstats()` refers to "favorite statistics"!

**Create an object and assign the output of `favstats()` to that object**

```{r}
#creating favstats table
fav_dat <- favstats(weight~Diet, data = diet_dat)
# inspect the contents of fav_dat
fav_dat
```

The results of your `favstats()` function are stored in a data frame with several columns. We can access single columns using the `$` sign. The column headed `n` contains the number of observations, and you need this in order to convert standard deviations into standard errors. To calculate se we want R to use `fav_dat$n` in our calculation, we can substitute this as well as the values that we already calculated for sd `chick_sd` into the equation

```{r}
chick_se <- chick_sd/(sqrt(fav_dat$n))
```

**Modify your R code as you build up your script. Include additional comments using `#` symbols, so that if you come back after 6 months you will still understand the R script. Add some notes about the above code as comments to demonstrate that you understand what each bit is doing. **

#### Creating a data frame 

We can use the `c()` function to create a vector (a line of numbers) and the `data.frame()` function to joint them together as data frames (a data frame is a table of data).
Using the `data.frame()` function create a data frame that contains the objects that you have just created as well as the mean and median for each group that you created earlier

 + `chick_mean`
 + `chick_med`
 + `chick_var`
 + `chick_sd`
 + `chick_se`

```{r, echo = FALSE}
diet_stats <- data.frame(chick_mean,
                         chick_med,
                         chick_var,
                         chick_sd,
                         chick_se)
diet_stats
```


Now you have a data frame that contains summary statistics describing your dataset that might be useful in a report. 

## Data visualization

Lets visualize the data that we have just been investigating

For visualizing a single variable:

$$\text{plot type(~variable, data= dataset)}$$

For visualizing two variables: 

$$\text{plot type(variable y ~ variable x, data= dataset)}$$

Because we are using the `ggformula` package the plotting functions that we will use will be preceded by `gf_` so for a boxplot we will use `gf_boxplot()` for a bar chart we use `gf_bar()`

**Create a bar chart to show how many observations there are in each diet category**

```{r, eval = FALSE}
gf_bar(~Diet, data = diet_dat)
```

Make some changes to the plot so that it looks something like this:

```{r, echo = FALSE}
gf_bar(~Diet, fill= ~Diet, data = diet_dat) %>% 
  gf_labs( y = "Chicks (n)") %>% 
  gf_theme(theme_minimal())
```

You will need to:

 + add a `fill=` argument to the plot to colour the bars by diet
 + use the `gf_labs()` function to change the label of the Y axis
 + use the `gf_theme()` function to change the background
 
Remember you will need to use the pipe `%>%` (`r emo::ji("package")` dplyr) to join the functions together.

As an extra challenge you can modify the colours using the `gf_refine()` and `scale_fill_manual()` functions to change the colours to four of your favorites.

**REMEMBER** to comment your code so that you can understand it in future (or refer back to it later on in this practical)

If you get stuck the code below gives an example of how to achieve the desired plot.
There are many colours to choose from which can be found online: https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/

```{r, eval = FALSE}
# creating the bar chart 
gf_bar(~Diet, fill= ~Diet, data = diet_dat) %>%  # THEN
  gf_labs( y = "Chicks (n)") %>%                 #change the labels
  gf_theme(theme_minimal()) %>%                  #change the theme
  gf_refine(scale_fill_manual(values = c("blue", "red", "yellow", "green"))) 
```

*modify the below boxplot*

1. Alter the plot type from boxplot to violin plot
2. Add data points that are shaped according to the diet the `gf_sina()` function will be useful
3. Modify the labels so that the units (g) are displayed with the weight
4. Modify the theme and colours to match the bar plot you previously made
5. *Bonus task* fill the violins with colour and alter the transparency using `alpha()`

```{r, echo = FALSE}
gf_boxplot(weight~Diet, data = diet_dat)
```

You might notice that the arguments `fill` and `colour` do slightly different things depending on the geometry (the violin or the points) that you are dealing with, play around with them to see what the differences are.

You should end up with a plot that looks like the one below

```{r}
gf_violin(weight~Diet, colour = ~Diet, fill= ~Diet, alpha = 0.3, data = diet_dat) %>%       # THEN
  gf_sina(shape = ~Diet, colour= ~Diet) %>%      #add points THEN
  gf_labs(y = "Weight (g)") %>%                  #change the labels THEN
  gf_theme(theme_minimal()) %>%                  #change the theme THEN
  gf_refine(scale_colour_manual(values = c("blue", "red", "yellow", "green"))) %>%
  gf_refine(scale_fill_manual(values = c("blue", "red", "yellow", "green")))
```


#### Using the `growth_dat` data

Using the skills that you have acquired during this practical, investigate the `growth_dat` object that we created at the start.

Plot trajectories of the mean growth of chicks being fed each diet across the experimental time period 

The `gf_line()` function will be of use, remember if you get stuck consult the help files.

Use the skills that you have just been practicing to modify the plot so that it has the same overall appearance (colours and theme) as the previous plots.

```{r,echo= FALSE}
growth_dat <- read.csv("Data/Chick_growth.csv")
 gf_line(Weight~Time, colour = ~Diet, data = growth_dat) %>%  # THEN
  gf_labs(x = "Day",y = "Weight (g)") %>%                     # change the labels THEN
  gf_theme(theme_minimal()) %>%                               # change the theme to a simple one THEN
  gf_refine(scale_colour_manual(values = c("blue", "red", "yellow", "green"))) # define colours
```



## Export data and plots

Now that you have created some summary data and plots that describe the dataset you need to export them to be able to put them in a report.

Export the data frame that you created detailing the mean, median, variance, standard deviation and standard error of chick weights. 

Data frames can be exported by writing a file with the `write.csv()` function.
The arguments of the `write.csv()` function are the name of the `object` that you want to export and the `filepath` including the file name of the data file that you want to create. 

```{r, eval = FALSE}
# note that the file path specifies that the file should be created in the Data folder
write.csv(my_data_frame, "Data/Chick_summary.csv")
```

You should now see the file that you have just created in your file explorer, you can open the file in Excel  and use this to create a table that you can import into a Microsoft Word document. 

Plots can be saved  from the plots pane.
Use the arrows to navigate through the plots to find the ones that you want to save such as the bar chart of number of chicks in each category, the violin plot of chick weights and the plot of chick growth through time. 
For each plot that you want to save click `Export` then `save as image` in the preview pane you can alter the size of the plot and name the file that you want to create.

Finally open a Word document and insert the plots and summary table giving each a descriptive caption. Write a short paragraph that describes how the different diets in the study impact the growth of chickens, referring to your figures and tables. 


