---
title: 'Practical 1: Data import Summary and display'
author: "BIO2020"
output:
  word_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, message=FALSE, warning= FALSE}
library(bio2020)
```

## Aims and objectives of Practical 1
The overall aim of this practical is to help you become more familiar with RStudio, what its main panels are for, and some basic summary statistics and visualisations. The specific objectives are to:

1. explain the concept of RStudio projects to allow you to store data, files containing R commands (known as scripts), and the 4 main panels in RStudio
2. demonstrate the value of .csv files (comma separated files) as these can be read / written by both R and Microsoft Excel, and the functions to do this.
3. understand free R packages to extend the power of R. How to install and load packages for use.
4. how to calculate simple summary statistics of the data you have imported into R
5. create of some simple summary plots to aid interpretation
6. show you how these graphs and tables of calculated statistics can be exported to Microsoft Word and Microsoft Excel

We will primarily focus on two datasets: 
* `Chick_Diet.csv` This contains the final weights of chicks after 21 days on four different diets.
* `Chick_growth.csv` This shows the average growth rate on each day of all the chicks from day 0 (hatching) to day 21.

This practical assumes you are using RStudio rather than the older RGui interface to R. The RGui interface is, however, **much simpler** and some students prefer to use it instead. The main difference is that you typically write your R scripts in Notepad (or TextEdit on an Apple Mac) and copy-and-paste the R commands into the RGui. If you would prefer to use the RGui please ask myself or one of the demonstrators.

## 1. RStudio projects and the RStudio screen
### 1.1 What is a project and how to create one
RStudio projects provide a simple method of ensuring that all your files are settings for a particular piece of work are collected together. I generally create a separate RStudio project for each experiment or survey that I am involved in. It allows me to keep my data, analytical commands and results organised together. We are going to start by creating a Project called 'BIO2020' to keep all of our work relating to the 'BIO2020' course together in one place.

Start by opening up R Studio on your computer. 
To create a new project click on the main menu on  `File` > `New Project`  
You should now see this popup window: 

```{r, echo = FALSE}
knitr::include_graphics("http://www.rstudio.com/images/docs/projects_new.png")
```

Select `New directory`  then  `New Project`

Give your project a name (eg. the name of the module) and select where on your computer you want that to live.
Click `Create project` and you should now see the name of your project displayed in the top right hand side of your R Studio window. 

**NOTE** If you are an organised person and you had already created a folder for all of the work associated with the BIO2020 module you can select `Existing Directory` navigate to your already existing folder and then select create project and the `.RProj` file will live in that folder alongside all your other files

Within your BIO2020 Project folder now create a `r emo::ji("file_folder")`  sub-folder called **Data**. We will store the data that you want to analyse in this folder. 

The next step is to create a new `script` to store all of the code for today's practical. 
In the top left click `file` > `new file` > `R script`
Click on the save icon `r emo::ji("floppy_disk")` to save this script and give it a meaningful name eg. `Practical_1.R`

Depending on your system, your RStudio window will roughly look like this:

![RStudio Screen](images/RStudio_screen_practical1.png)

### 1.2 Understanding the components of the RStudio screen

* **Top left** This is the new empty 'script' file `Practical_1.R` that you have just created. You can use this to store your R commands for later re-use. You can put comments after a `#` sign to help remind you what the commands do.
* **Top right** This has several tabs, but the one shown above is the 'Environment' which will show the names of tables of data, the names of results of analyses etc. As you have not done anything yet, it is empty. Another useful tab is called 'History' which contains a record of the R commands you have issued.
* **Bottom right** Again, several tabs. You will often use the 'Plots' and 'Help' tabs. Shown above is the 'Files' tab which shows the `BIO2020.Rproj` file which contains all your settings (colours, font size, zoom level etc.) and your `Practical_1.R` which is also displayed in the top left panel.
* **Bottom left** This is headed 'Console'. You can enter R commands directly into the Console. You can also copy R commands from your `Practical_1.R` script into the Console for re-use. It is this ability to store a set of R commands in a simple script for re-use that is so valuable. 


### 1.3 Cookery with RStudio?
Some people find a cooking analogy useful to help understand the different components of the RStudio screen!

```{r, fig.align='center', echo = FALSE}
knitr::include_graphics("images/Rkitchen.png")
```

### 1.4 Running R commands

You might notice that in the online interactive website tutorials that you completed on your own we ran R code by clicking on a big green run code button, when we are working in RStudio it's a little bit different. 

You write your R commands in your script which means you can save it and repeat the exact analysis weeks or months later. This is known as **reproducible research**. Later in this practical, there are a couple of ways to *run* the R and you can choose whichever feels best for you. 

1. Highlight the R commands in the script that you want to run and then press the `run` button that is available at the top of the script

2. Place your cursor anywhere on a line in your R script that you want to run and press <kbd>Ctrl</kbd> + <kbd>Return</kbd> (<kbd>Cmd</kbd> + <kbd>Return</kbd> on Apple Mac) together

Either of these actions sends your R commands to the console where it is executed so that R carries out the instructions.

## 2. Importing data from an external csv file into RStudio
### 2.1 What are csv files?
Comma Separated Format (.csv) files are very useful. Tables of data can be entered into Microsoft Excel, then exported via Excel's **File -> Save As** menu. These .csv files can then be imported into R/RStudio for sophisticated analyses. Likewise, you can export tables of results from R/RStudio back to Excel as .csv format.

For this practical we will be using the following data files:

 + Chick_Diet.csv
 + Chick_growth.csv

Find these 2 files on Canvas and download them to your computer. By default they will probably end up in your `Downloads` folder. **Please copy both .csv files to the `Data` folder you created in Section 1 of this practical**. To use these files we need to import them into R and store each one in R's memory as an "object". An object in R can be a table of raw data, results of analysis, a graph saved for later use. Open the two .csv files in Microsoft Excel to have a quick look at them. (**Note:** Excel might complain that you have not saved the files when you try to close Excel, as Bill Gates gets upset if you do not use his proprietary file format. Ignore the warning.)

* `Chick_Diet.csv`  contains the variables weight, Time, Chick and Diet. It contains the weights of 45 individual chicks after a 21 day time period on 4 diets; A, B, C and D.
* `Chick_growth.csv` contains the variables Weight (note that this one is with a capital W), Time and Diet. It contains the average weight of all the chicks on each day of the experiment, from day 0 (hatching) to day 21, for each of the same 4 diets.

### 2.2 Where to type your R commands
We are now going to show you how to import the data from your .csv files into RStudio and temporarily store them as R "objects" called `diet_dat` and `growth_dat` using the `read.csv()` function. Please write your R comands in the script `Practical_1.R` (top left panel of RStudio). You can save and re-run the script later. You do not actually need to save the temporary R objects `diet_dat` and `growth_dat` as you can re-create them within seconds from your R script. **In contrast, it is always important to save your script before you close R/RStudio**.

The `read.csv()` function takes a single "argument" to tell R the name of the .csv you are importing. This is the full "path" to the .csv file, therefore since your .csv files are in a `Data` folder you also need to include the word `Data` in the argument, as well as the name of the .csv file. **Important** R is "case-sensitive", so if you put `chick_diet.csv`, `Chick_diet.csv` or `chick_Diet.CSV` etc. you will get an error that R cannot find the file. 

Type the next three lines into the top of your `Practical_1.R` script in the top-left panel of RStudio:

```{r}
# Introduction to R. Basic data handling

diet_dat <- read.csv("Data/Chick_Diet.csv") # Read in diet data
```

A few points about the above 4 lines of code

* The first line contains the `#` sign. This tells R to ignore the rest of the line. This is a "comment" and is probably the most important single command you will ever use. I put comments throughout my R scripts, so that when I re-use them months later I understand what they are doing. I generally use the first line to remind myself what the script is going to do.
* The second line is blank. Students tend to be poor at including blank line(s). However, it is a good idea to group a set of related R commands together, and then separate them with one or two blank lines, in the same way that you use paragraphs when writing an essay to structure the text.
* The third line contains an R function called `read.csv()` which imports the `Chick_Diet.csv` file into the R environment. It takes a single 'argument' in double-quotation marks, namely where the csv file is stored and its name. Note that it also includes the name of the `Data` folder where you stored the .csv file
* The third line contains the `<-` symbol that points into `diet_dat`. This means "assign the output the `read.csv()` function into the R table of data called `diet_dat`". If you look at the top-right window of you should notice that the "Environment" tab is no longer empty, but now contains the `diet_dat` table. Tables of data in R are usually known as "data frames" and you will see this term pop up several times in this course.
* Finally, the third line also contains a comment, but at the end of the line, after the R commands.

<!-- Note for demonstrator, if they have trouble reading in the data file check where the script file is saved, if it's in a sub-folder of the project the code specifying the file path will need to escape that sub-folder first using ../ so they need  read.csv("../Data/Chick_Diet.csv")-->

### 2.3 Check the data that you have loaded
After you have imported data into RStudio it is useful to look at the first few rows, understand its structure, check the names of variables (columns) etc. Some suggested functions are `head()` `str()` `summary()` `nrow()` `ncol()` `names()`. Use these functions to answer the following questions about the data

 1. What are the names of the columns in the `diet_dat` data frame?
 2. How many variables (columns) and how many observations (rows) are in the dataset? 
 3. How heavy is the heaviest chicken? And is this the same in both of the datasets?

**Reminder** Make sure to comment your script, using the `#` write some comments (notes) to annotate the script that you have just written so that you know what all the lines do, e.g.

```{r, eval = FALSE, echo= TRUE}
# reading in the Chick_Diet data file 
diet_dat <- read.csv("Data/Chick_Diet.csv")

# Display the first few lines of the data
head(diet_dat)
# Inspect the structure of the data
str(diet_dat)
# Try the nrow(), ncol() and summary() functions
```

Repeat the process with the `Chick_growth.csv` file:

```{r, eval = TRUE, echo=TRUE}
# reading in the Chick_Diet data file 
growth_dat <- read.csv("Data/Chick_growth.csv")

# Display the first few lines of the data with the head() function
# Try the nrow(), ncol() and summary() functions
```
 
```{r, eval = TRUE, echo=FALSE}
# ensure both datasets available later 
growth_dat <- read.csv("Data/Chick_growth.csv")
diet_dat <- read.csv("Data/Chick_Diet.csv")
```


## 3. R Packages
### 3.1 What is an R package
One of the reasons why R is so popular amongst scientists is that its basic functionality can be readily extended by packages. Anyone can write one, and they are made publically available free of charge. Packages exist for bioinformatics, animal tracking, habitat analysis, species distributions, phylogenetics. There are over 10,000 free packages available.

### 3.2 Installing packages
You can install a package even if you do not have Administrator rights for a PC using the `install.packages()` function. **This only has to be used once to install a package**. If you have not already done so, please follow the instructions at [Getting Started](https://ncl.instructure.com/courses/23926/pages/the-bio2020-r-package) to install several packages including:

* `mosaic`, which gives a unified interface for statistics. This also automatically installs several other packages such as `ggformula` which simplifies plotting, `tidyr` for manipulating data etc.
* `vegan`, which handles large compositional datasets, of the sort that might be obtained from molecular / bioinformatics studies, as well as species assemblage data for plants, birds, mammals etc.
* `car`, this is useful to clarify analyses if you have any missing data
* `bio2020`. I have written this package (which is why the installation method was slightly different). It gives easier to understand graphics and commands for the `vegan` package, and automatically loads all the other packages you need.

### 3.3 Activating packages
To use the new functions in a package you need to activate it or "load" it. This has to be done once in **every** R/RStudio, using the `library()` function. The best practice is to put the `library()` function near the start of your script, so you do not forget about it. The little `bio2020` package I have written should (hopefully!) automatically load all the other packages you need for this course, to make things easier. Put the following line near the start of your `Practical_1.R` script and run it.

```{r, echo=TRUE, eval=FALSE}
library(bio2020)
```

You should see a message welcoming you to the package, and you have access to the extra functions in `mosaic`, `ggformula`, `tidyr`, `vegan`, `car` and several other packages automatically. I recommend that you put the line `library(bio2020)` near the start of all your R scripts.

## 4. Summary statistics
### 4.1 Goal-oriented approach
Please have a look at the [Course Handbook](https://ncl.instructure.com/courses/23926/files/3203623?fd_cookie_set=1) on the Canvas website. You will see there that we are using a goal-oriented approach, where your goal can be a simple statistic, a data analysis or a graph. Let us start with some simple statistics on the `diet_dat` data.

We can calculate some summary statistics to see if there are differences between chicks being fed different diets. Calculate the mean weights for chicks being fed different diets.

Remember we are using the formula 

$$\text{statistic(variable=group, data=dataset)}$$

Where:

+ **statistic** = the statistic that we want to calculate (mean, median, sd, etc.)
+ **variable** = the name of the column containing the variable that we are interested in 
+ **group** = the name of the column containing information by which we want to group the data

For each group we can calculate statistics such as the mean and median

```{r}
mean(weight~Diet, data = diet_dat)
median(weight~Diet, data = diet_dat)
```

The above two lines print the mean and median on the screen. If you do not remember the difference between means and medians, have a look at [Measures of Central Tendancy](https://naturalandenvironmentalscience.shinyapps.io/variation/#section-measures-of-central-tendency). You can also save the results of your mean and median in temporary variables `chick_mean` and `chick_med` for later re-use:

```{r, echo= FALSE}
chick_mean <- mean(weight~Diet, data = diet_dat)
chick_med <- median(weight~Diet, data = diet_dat)
```


Both median, and especially mean, can be sensitive to outliers: see the interactive on the above website. To get a good understanding of our data we need to calculate some statistics that give us an idea of how our data is **spread** about the mean. If this is unfamiliar to you go back over other sections of the interactive website tutorial linked above.

Thankfully because we are doing our analysis in R we don't have to calculate measures such as variance, standard deviation and standard error by hand, we can use functions to help us.

### 4.2 Calculate the variance and standard deviation for each diet
This is straightforward, using the functions `var()` and `sd()`

```{r}
# calculate variance for each group
var(weight~Diet, data = diet_dat)
# calculating standard deviation for each group
sd(weight~Diet, data = diet_dat)
```

As before, rather than merely displaying these values on screen, we can put them into temporary R "objects" called  `chick_var` and `chick_sd` and assign the output of the `var()` and `sd()` functions to those objects.

```{r}
# calcualating variance for each group
chick_var <- var(weight~Diet, data = diet_dat)
#calculating standard deviation for each group
chick_sd <- sd(weight~Diet, data = diet_dat)
```

### 4.3 Calculate standard error
Remember that we also discussed Standard Error as a useful measure that can be calculated as:

$$se = \frac{\sigma}{\sqrt{n}}$$

We have already calculated the variance but for the calculation of se we need to know n, the number of observations in our group.
Again there is no need to count the number of observations in each group by hand, lets use the `favstats()` function which also computes some other useful measures that we might be interested in. The name `favstats()` refers to "favorite statistics"!

First, we store the results of all the commonly used statistics using `favstats()` in a temporary R object, which we'll call `fav_dat`:

```{r}
#creating favstats table
fav_dat <- favstats(weight~Diet, data = diet_dat)
# inspect the contents of fav_dat
fav_dat
```

The results of your `favstats()` function are stored in a data frame with several columns. We can access single columns using the `$` sign. The column headed `n` contains the number of observations, and you need this in order to convert standard deviations into standard errors. **We can access the values in a single column of a table (data frame) using the `$` symbol**. Here we want to access the column `n` which contains the number of chicks in each diet. To calculate se we want R to use `fav_dat$n` in our calculation, we can substitute this as well as the values that we already calculated for sd `chick_sd` into the equation

```{r}
chick_se <- chick_sd/(sqrt(fav_dat$n))
```

**Note:** It is important to modify your `Practical_1.R` script as you go along, adding additional comments using `#` symbols, so that if you come back after 6 months you will still understand the R script. Add some notes about the above commands as comments to demonstrate that you understand what each bit is doing.

### 4.4 Assembling all the summary statistics into a new table 
We have created summary statistics with mean, median, variance, standard deviation and standard error. It would be useful to put them all into one table, or data frame. This is easy to do using the (you guessed it!) `data.frame()` function:

 + `chick_mean`
 + `chick_med`
 + `chick_var`
 + `chick_sd`
 + `chick_se`

```{r, echo = FALSE}
diet_stats <- data.frame(chick_mean,
                         chick_med,
                         chick_var,
                         chick_sd,
                         chick_se)
diet_stats
```


Now you have a data frame that contains summary statistics describing your dataset that might be useful in a report. 

## 5. Basic summary plots

Lets visualize the data that we have just been investigating

For visualizing a single variable:

$$\text{plot type(~variable, data= dataset)}$$

For visualizing two variables: 

$$\text{plot type(variable y ~ variable x, data= dataset)}$$

Because we are using the `ggformula` package the plotting functions that we will use will be preceded by `gf_` so for a boxplot we will use `gf_boxplot()` for a bar chart we use `gf_bar()`

**Create a bar chart to show how many observations there are in each diet category**

```{r, eval = FALSE}
gf_bar(~Diet, data = diet_dat)
```

Make some changes to the plot so that it looks something like this:

```{r, echo = FALSE}
gf_bar(~Diet, fill= ~Diet, data = diet_dat) %>% 
  gf_labs( y = "Chicks (n)") %>% 
  gf_theme(theme_minimal())
```

You will need to:

 + add a `fill=` argument to the plot to colour the bars by diet
 + use the `gf_labs()` function to change the label of the Y axis
 + use the `gf_theme()` function to change the background
 
Remember you will need to use the pipe `%>%` (`r emo::ji("package")` dplyr) to join the functions together.

As an extra challenge you can modify the colours using the `gf_refine()` and `scale_fill_manual()` functions to change the colours to four of your favorites.

**REMEMBER** to comment your code so that you can understand it in future (or refer back to it later on in this practical)

If you get stuck the code below gives an example of how to achieve the desired plot.
There are many colours to choose from which can be found online: https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/

```{r, eval = FALSE}
# creating the bar chart 
gf_bar(~Diet, fill= ~Diet, data = diet_dat) %>%  # THEN
  gf_labs( y = "Chicks (n)") %>%                 #change the labels
  gf_theme(theme_minimal()) %>%                  #change the theme
  gf_refine(scale_fill_manual(values = c("blue", "red", "yellow", "green"))) 
```

*modify the below boxplot*

1. Alter the plot type from boxplot to violin plot
2. Add data points that are shaped according to the diet the `gf_sina()` function will be useful
3. Modify the labels so that the units (g) are displayed with the weight
4. Modify the theme and colours to match the bar plot you previously made
5. *Bonus task* fill the violins with colour and alter the transparency using `alpha()`

```{r, echo = FALSE}
gf_boxplot(weight~Diet, data = diet_dat)
```

You might notice that the arguments `fill` and `colour` do slightly different things depending on the geometry (the violin or the points) that you are dealing with, play around with them to see what the differences are.

You should end up with a plot that looks like the one below

```{r}
gf_violin(weight~Diet, colour = ~Diet, fill= ~Diet, alpha = 0.3, data = diet_dat) %>%       # THEN
  gf_sina(shape = ~Diet, colour= ~Diet) %>%      #add points THEN
  gf_labs(y = "Weight (g)") %>%                  #change the labels THEN
  gf_theme(theme_minimal()) %>%                  #change the theme THEN
  gf_refine(scale_colour_manual(values = c("blue", "red", "yellow", "green"))) %>%
  gf_refine(scale_fill_manual(values = c("blue", "red", "yellow", "green")))
```


#### Using the `growth_dat` data

Using the skills that you have acquired during this practical, investigate the `growth_dat` object that we created at the start.

Plot trajectories of the mean growth of chicks being fed each diet across the experimental time period 

The `gf_line()` function will be of use, remember if you get stuck consult the help files.

Use the skills that you have just been practicing to modify the plot so that it has the same overall appearance (colours and theme) as the previous plots.

```{r,echo= FALSE}
growth_dat <- read.csv("Data/Chick_growth.csv")
 gf_line(Weight~Time, colour = ~Diet, data = growth_dat) %>%  # THEN
  gf_labs(x = "Day",y = "Weight (g)") %>%                     # change the labels THEN
  gf_theme(theme_minimal()) %>%                               # change the theme to a simple one THEN
  gf_refine(scale_colour_manual(values = c("blue", "red", "yellow", "green"))) # define colours
```



## Export data and plots

Now that you have created some summary data and plots that describe the dataset you need to export them to be able to put them in a report.

Export the data frame that you created detailing the mean, median, variance, standard deviation and standard error of chick weights. 

Data frames can be exported by writing a file with the `write.csv()` function.
The arguments of the `write.csv()` function are the name of the `object` that you want to export and the `filepath` including the file name of the data file that you want to create. 

```{r, eval = FALSE}
# note that the file path specifies that the file should be created in the Data folder
write.csv(my_data_frame, "Data/Chick_summary.csv")
```

You should now see the file that you have just created in your file explorer, you can open the file in Excel  and use this to create a table that you can import into a Microsoft Word document. 

Plots can be saved  from the plots pane.
Use the arrows to navigate through the plots to find the ones that you want to save such as the bar chart of number of chicks in each category, the violin plot of chick weights and the plot of chick growth through time. 
For each plot that you want to save click `Export` then `save as image` in the preview pane you can alter the size of the plot and name the file that you want to create.

Finally open a Word document and insert the plots and summary table giving each a descriptive caption. Write a short paragraph that describes how the different diets in the study impact the growth of chickens, referring to your figures and tables. 


